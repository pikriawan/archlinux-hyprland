#!/bin/bash
screenshot() {
    directory=$(xdg-user-dir PICTURES)/Screenshots
    file=$(date +"Screenshot_%Y%m%d_%H%M%S.png")

    mkdir -p $directory

    selection=$(echo -e "Selection\nWindow\nScreen" | rofi -dmenu -p "screenshot_frame_2" -theme-str "entry {placeholder: \"Screenshot\";}")

    case $selection in
        "Selection")
            geometry=$(slurp)

            if [ -z "$geometry" ]; then
                return 1
            fi

            grim -g "$geometry" - | magick - -shave 1x1 PNG:- | tee "$directory/$file" | wl-copy
            dunstify -a "Screenshot" -i "camera-photo" "Screenshot taken"
            ;;
        "Window")
            geometry=$(hyprctl activewindow -j | jq -j '.at[0],",",.at[1]," ",.size[0],"x",.size[1]')

            if [ "$geometry" = "null,null nullxnull" ]; then
                return 1
            fi

            grim -g "$geometry" - | tee "$directory/$file" | wl-copy
            dunstify -a "Screenshot" -i "camera-photo" "Screenshot taken"
            ;;
        "Screen")
            grim - | tee "$directory/$file" | wl-copy
            dunstify -a "Screenshot" -i "camera-photo" "Screenshot taken"
            ;;
    esac
}

wayfreeze --hide-cursor & PID=$!; sleep .1; screenshot; kill $PID
